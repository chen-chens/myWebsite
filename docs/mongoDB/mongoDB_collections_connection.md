
# MongoDB Collections Connection

## Embedded Data Models 與 Reference Data Models 的差別
- Embedded Data Models ：會複製一份資訊。
- Reference Data Models：不會複製，只有關聯。

:::note title="ChatGPT"

**Embedded Data Models（嵌入式資料模型）：**
在嵌入式資料模型中，一個文檔（document）中包含了其他相關文檔的完整資訊。這意味著相關的資訊被嵌入到主文檔中，形成一個嵌套的資料結構。嵌入式資料模型通常用於表達具有強關聯性的資料，例如一個博客文章和其評論。

優點：
  - 查詢效率高：因為所有相關資訊都存在同一個文檔中，所以查詢時無需額外的查找操作。
  - 數據一致性：更新主文檔時，相關資訊也會同時更新，保持數據的一致性。

缺點：
  - 數據冗餘：相關資訊被複製多次，可能導致數據冗餘和更新的困難。
  - 文檔大小限制：MongoDB 有文檔大小限制（預設為 16MB），如果嵌入的資料超過限制，則無法使用嵌入式資料模型。

---

**Reference Data Models（參考資料模型）：**
在參考資料模型中，文檔之間通過引用（參考）來建立關聯。一個文檔中只包含對其他文檔的引用，而實際的相關資訊則存在於被引用的文檔中。

優點：
  - 節省存儲空間：相關資訊只存儲在被引用的文檔中，避免了數據冗餘。
  - 適應變動的資料：當相關資訊變動時，只需更新被引用的文檔，而不需要更新所有引用它的文檔。

缺點：
  - 查詢效率較低：在查詢時需要額外的查找操作，以獲取相關資訊。
  - 需要額外的關聯操作：在獲取相關資訊時，需要進行額外的關聯操作，例如使用 $lookup 等操作。
:::


---

## MongoDB `aggregate` 操作查詢指令

### aggregate 是 MongoDB 中的一個功能，可以對 Collections 進行多個操作，例如篩選、排序、分組、計算等，以生成最終的結果。每個操作都是一個階段（stage），階段按照順序進行，並將前一個階段的結果作為輸入傳遞給下一個階段。

- `$match`: 依據指定條件篩選資料。
- `$lookup`: 關聯其他 Collections 資料。
- `$sort`: 對資料進行排序。
- `$limit`: 限制返回的資料數量。
- `$group`: 將資料進行分組計算。
- `$project`: 指定返回的資料欄位。
- `$skip`: 跳過指定數量的資料。
- `$unwind`: 展開關聯資訊。


